/*! 20220624191759
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: https://www.dynamsoft.com
*
* Copyright 2022, Dynamsoft Corporation
* Author: Dynamsoft Support Team
*
* Module: Upload
* Version: 17.3
* 
*/
var Dynamsoft=window.Dynamsoft||{};!function(e){e.DWT||(e.DWT={}),e.Lib||(e.Lib={})}(Dynamsoft),Dynamsoft.aryAddonReadyFun=Dynamsoft.aryAddonReadyFun||[],Dynamsoft.AddonReady=Dynamsoft.AddonReady||function(e){Dynamsoft.aryAddonReadyFun.push(e)},Dynamsoft.AddonReady(function(s,e){Dynamsoft.DWT.EnumTransferErrorCode={TRANS_OK:0,TRANS_URL_MALFFORMAT:1,TRANS_FAILED_RESOLVE_PROXY:2,TRANS_FAILED_RESOLVE_HOST:3,TRANS_FAILED_CONNECT:4,TRANS_REMOTE_ACCESS_DENIED:5,TRANS_PARTIAL_FILE:6,TRANS_UPLOAD_FAILED:7,TRANS_READ_FAILED:8,TRANS_OUT_OF_MEMORY:9,TRANS_REMOTE_FULL_DISK:10,TRANS_OPERATION_TIMEOUT:11,TRANS_SERVICE_ERROR_404:12,TRANS_SERVICE_ERROR_500:13,TRANS_SERVICE_ERROR_503:14,TRANS_SERVICE_ERROR:15,TRANS_NOT_SEND:16,TRANS_WAITFOR_SEND:17,TRANS_SENDING:18,TRANS_PAUSE:19,TRANS_FINISHED:20,TRANS_NULL_POINTER:21,TRANS_INVALID_ID:22,TRANS_Failed:23,TRANS_SERVICE_ERROR_MORE_THAN_500:24,TRANS_SERVICE_ERROR_LESS_THAN_200:25,TRANS_SERVICE_ERROR_MORE_THAN_300:26,TRANS_CANNOT_FINDFILE:27,TRANS_ABORT:28,TRANS_NOT_FINISHED:29,TRANS_TASK_PREPARE_INIT:30,TRANS_TASK_INIT:31,TRANS_BEYOND_MAXSIZE:32};function t(){var e,n=!1,o=Dynamsoft.navInfoSync.bMobile;return Dynamsoft.DWT&&(n=!1===Dynamsoft.DWT.UseLocalService),Dynamsoft.navInfo&&(e=Dynamsoft.navInfo,o=o||e.bPad||e.biPhone||e.biPad),n||o}var c=Dynamsoft,i=Dynamsoft.dcp,a=[1,7,2,"1026"],f="upload_"+a.join(""),n={Version:"1.0",HttpVersion:"1.1",ServerUrl:"",FileName:"",VERIFYPEER:!1,VERIFYHOST:!1,BlockSize:10240,ThreadNum:1,OnUploadTransferPercentage:function(e,n){},OnRunSuccess:function(e){},OnRunFailure:function(e,n,o){}},p=0,F="",l=function(){p=-1,F="The zip file that contains the upload library (.dll) is invalid."},R=function(){p=-2,F="Upload failed because the url to upload to is invalid."},d=function(e,n,o){p=-3,e?F="Upload cancelled.":(F=n&&""!=n?"Upload failed with error: "+n:"Upload failed.",n&&""!=n&&(F=F+"("+o+")"))},m=function(){p=-4,F="Upload failed because the file to upload has invalid content."},o=function(){p=-5,F="Invalid upload job id."},E=function(){p=-6,F="Cannot create an upload job."},T=function(){p=-7,F="The file name is incorrect in the upload job."},r=function(){p=-8,F="Can not cancel all jobs when at least one job is still being created."},u=function(){p=-9,F="The zip file that contains the upload library (.dll) download failed."},S=function(){p=-2400,F="File uploader addon doesn't work under current settings."},_=function(){p=0,F=""};function U(){}function D(e){this.job=e}function A(e){this.job=e}U.prototype={runWaiting:0,CreateJob:function(){var e={HttpHeader:{},documents:[],formFields:[],bEvent:!1};return s.mix(e,n),e.SourceValue=new D(e),e.FormField=new A(e),e},Run:function(r){var e,t=this,n='""',o=r.ServerUrl,i="";if((!r.ar||!r.cu)&&c.DWT&&(c.DWT.ProductKey&&(n='"'+c.DWT.ProductKey+'"'),c.DWT.handshakeCode||c.DWT.organizationID))return Dynamsoft.DWT.lglic().then(function(e){r.ar=e.ar,r.cu=e.cu,t.Run(r)}),!0;if(!s.isString(o)||""==o)return r.id=-1,R(),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1),!1;if(!r.documents||!s.isArray(r.documents)||r.documents.length<=0)return r.id=-1,m(),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1),!1;for(r.Url=o,delete r.ServerUrl,e=0;e<r.documents;e++){var a=r.documents[e];if(!s.isString(a.files)||""==a.files)return r.id=-1,T(),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1),!1;s.isString(a.remoteName)&&""!=a.remoteName||(a.remoteName="RemoteFile")}var l=r.SourceValue,d=(delete r.SourceValue,r.FormField),u=(delete r.FormField,s.stringify(r)),u=s.replaceAll(u,'"',"'");r.ServerUrl=o,delete r.Url,r.SourceValue=l,r.FormField=d,o=['{"id":"',1,'","method":"RunUploadFile","version":"',f,'","parameter":[',n,',"',u,'"'],r.ar&&r.cu?(i=[',"',r.ar,'","',r.cu,'",0]}'].join(""),delete r.ar,delete r.cu,o.push(i)):o.push("]}"),l=o.join(""),t.runWaiting++;return Dynamsoft.FileUploader._sendCmd("RunUploadFile",l,function(e){var n;t.runWaiting--,e&&((n=e.UploadId)&&0<n?(r.id=n,c.FileUploader.map[r.id]=r,c.FileUploader.ids.push(e.UploadId),r.OnUploadTransferPercentage&&r.OnUploadTransferPercentage(r,0)):(n=e.errorcode,e=e.errorstring,n&&e?(p=n,F=e):E(),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1)))},function(e,n,o){t.runWaiting--,c.FileUploader.parseHttpErrors(e,n,o),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1)}),!0},Cancel:function(r){if(!r.id||r.id<0)return o(),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1),!1;var e='{"id":"1","method":"DeleteUploadTask","version":"'+f+'","parameter":["'+r.id+'"]}';return Dynamsoft.FileUploader._sendCmd("DeleteUploadTask",e,function(e){c.FileUploader.deleteJobById(r.id)},function(e,n,o){c.FileUploader.parseHttpErrors(e,n,o),!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1)}),!0},CancelAllUpload:function(){var o=c.FileUploader.ids,e='{"id":"1","method":"DeleteUploadTask","version":"'+f+'","parameter":["'+o.join(",")+'"]}';if(0<this.runWaiting)return r(),!1;if(this.runWaiting<0&&(this.runWaiting=0),o.length<=0)return!0;return Dynamsoft.FileUploader._sendCmd("DeleteUploadTask",e,function(e){for(var n=0;n<o.length;n++)c.FileUploader.deleteJobById(o[n]);c.FileUploader.ids=[],c.FileUploader.map=[]},function(e,n,o){c.FileUploader.parseHttpErrors(e,n,o)}),!0},OnUploadTransferPercentage:function(e,n){},OnRunSuccess:function(e){},OnRunFailure:function(e,n,o){}},(c.SourceValue=D).prototype.Add=function(e,n,o){var r=this.job;if(!s.isString(e)||""==e)return T(),void(!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,p,F),r.bEvent=!1));o=o||"RemoteFile",e=Dynamsoft.Lib.replaceAll(e,"\\\\","\\\\"),r.documents.push({files:[e],fileName:n,remoteName:o})},c.FormField=A,c.FileUploader={ids:[],map:{},port:18625,protocol:"https://",ip:"127.0.0.1",wsUrl:"",running:!(A.prototype.Add=function(e,n){var o,r,t=n,i=e;if(null==t&&(t=""),!s.isString(i)||""==i||!s.isString(t))return!1;if(t=encodeURI(t),-1<(i=encodeURI(i)).indexOf("'")||-1<t.indexOf("'"))return!1;for(o=0;o<this.job.formFields.length;o++)if((r=this.job.formFields[o]).name==i)return r.value=t,!0;return this.job.formFields.push({name:i,value:t}),!0}),ws:null,nextLoopTime:600,deleteJobById:function(e){if(_(),t())return S(),!1;var n;if(e){for(n=0;n<c.FileUploader.ids.length;n++)if(e==c.FileUploader.ids[n]){c.FileUploader.ids.splice(n,1);break}var o=c.FileUploader.map[e];for(o.SourceValue.job=null,delete o.SourceValue,o.FormField.job=null,delete o.FormField,delete c.FileUploader.map[e],n=o.documents.length-1;0<=n;n--)o.documents.splice(n,1);for(n=o.formFields.length-1;0<=n;n--)o.formFields.splice(n,1);var r='{"id":"1","method":"DeleteUploadTask","version":"'+f+'","parameter":["'+e+'"]}';Dynamsoft.FileUploader._sendCmd("DeleteUploadTask",r)}},_sendCmdByWS:function(e,o,r){var n;return c.FileUploader.ws?n=c.FileUploader.ws:(n=i.newWebsocket(c.FileUploader.wsUrl),c.FileUploader.ws=n),n.onopen=function(){1==n.readyState?(n.onopen=null,n.send(e)):0==n.readyState&&setTimeout(n.onopen,100)},n.onmessage=function(e){var n=e.data;if("object"==typeof n)return e=n=null,void r();e=n.replace(/\0/g,"");try{(e=s.parse(e))&&"result"in e?o(e.result):r()}catch(e){s.log(n),r()}n=null},n.onerror=function(e){e&&s.log("websocket error: "+e),r()},n.onclose=function(e){n.onclose=null,n.onerror=null,n.onmessage=null,c.FileUploader.ws=null},!0},_sendCmd:function(e,n,o,r){if(Dynamsoft.DWT.ConnectWithSocket)return _sendCmdByWS(n,o,r);e=[c.FileUploader.protocol,c.FileUploader.ip,":",c.FileUploader.port,"/dcp/",f,"/",e,"?type=1&dsver=",a.join(""),"&ts=",s.now()].join("");return s.ajax({url:e,method:"post",dataType:"json",processData:!1,data:n,onSuccess:o,onError:r})},parseHttpErrors:function(e,n,o){var r,e=e&&s.isArray(e)&&2<e.length?(r=e[1],e[2]):(r=n,o);2==e.state&&0==e.status?"abort"===e.statusText?d(!0):R():d(!1,r,e.status)},loadHttpBlob:function(e,n,o,r,t,i,a){e={method:e,url:n,dataType:"blob",async:o,onSuccess:r,onError:function(e,n,o){c.FileUploader.parseHttpErrors(e,n,o),s.isFunction(t)&&t()}};s.isFunction(i)&&(e.beforeSend=function(e){e.addEventListener("progress",function(e){delete e.totalSize,delete e.position,i(e)},!1)}),s.ajax(e)},_OnPercentDone:function(){},Download:function(e,n,o){if(!s.isString(e))return l(),s.isFunction(o)&&o(p,F),!1;function r(){return u(),s.isFunction(o)&&o(p,F),!1}return c.FileUploader.loadHttpBlob("get",e,!0,function(e){i.loadZip(e,100,n,r)},r,!1)},Init:function(e,o,n){if(_(),t())return S(),s.isFunction(n)&&n(p,F),!1;function r(){i.detect.curPortIndex;var e,n=Dynamsoft.dcp.ports[0],n=Dynamsoft.navInfoSync.bSSL?(e="https://",n[1]):(e="http://",n[0]);c.FileUploader.port=n,c.FileUploader.protocol=e,c.FileUploader.ip=i.host,c.FileUploader.wsUrl=i._getDcpWsPreUrl(0),c.FileUploader.running=!0,o(new U),setTimeout(c.FileUploader.StatusLoop,500)}Dynamsoft.dcp.detect.bConnected?r():Dynamsoft.dcp.checkDcpV3(Dynamsoft.DWT.ProductKey,n,r)},Close:function(){Dynamsoft.DWT.ConnectWithSocket&&c.FileUploader.ws&&(c.FileUploader.ws.close(),c.FileUploader.ws=null),c.FileUploader.running=!1},VersionInfo:function(e,r){if(_(),t())return S(),s.isFunction(r)&&r(p,F),!1;var n='{"id":"1","method":"VersionInfo","version":"'+f+'","parameter":[]}';return Dynamsoft.FileUploader._sendCmd("VersionInfo",n,e,function(e,n,o){c.FileUploader.parseHttpErrors(e,n,o),s.isFunction(r)&&r(p,F)}),!0},StatusLoop:function(){return _(),t()?(S(),!1):(c.FileUploader.GetUploadStatus(),c.FileUploader.running&&setTimeout(c.FileUploader.StatusLoop,c.FileUploader.nextLoopTime),!0)},GetUploadStatus:function(){if(_(),c.FileUploader.ids.length<=0)return!0;if(t())return S(),!1;var e='{"id":"1","method":"GetUploadStatus","version":"'+f+'","parameter":["'+c.FileUploader.ids.join(",")+'"]}';return Dynamsoft.FileUploader._sendCmd("GetUploadStatus",e,function(e){if(s.isArray(e))for(var n=0;n<e.length;n++){var o=(l=e[n]).id,r=c.FileUploader.map[o],t=l.percentage,i=l.errorcode,a=l.response,l=l.errorstring;r&&(i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_FINISHED?(r.OnUploadTransferPercentage(r,100,N(a)),!r.bEvent&&s.isFunction(r.OnRunSuccess)&&(r.bEvent=!0,r.OnRunSuccess(r,N(a)),r.bEvent=!1),c.FileUploader.deleteJobById(o)):i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_OK||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_NOT_SEND||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_WAITFOR_SEND||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_SENDING||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_PAUSE||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_TASK_PREPARE_INIT||i==Dynamsoft.DWT.EnumTransferErrorCode.TRANS_TASK_INIT?r.OnUploadTransferPercentage(r,t,N(a)):(!r.bEvent&&s.isFunction(r.OnRunFailure)&&(r.bEvent=!0,r.OnRunFailure(r,i,l,N(a)),r.bEvent=!1),c.FileUploader.deleteJobById(o)))}},function(e,n,o){}),!0}};var v=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function N(e){for(var n,o,r,t,i=e.length,a=0,l="";a<i;){for(;n=v[255&e.charCodeAt(a++)],a<i&&-1==n;);if(-1==n)break;for(;o=v[255&e.charCodeAt(a++)],a<i&&-1==o;);if(-1==o)break;l+=String.fromCharCode(n<<2|(48&o)>>4);do{if(61==(r=255&e.charCodeAt(a++)))return l}while(r=v[r],a<i&&-1==r);if(-1==r)break;l+=String.fromCharCode((15&o)<<4|(60&r)>>2);do{if(61==(t=255&e.charCodeAt(a++)))return l}while(t=v[t],a<i&&-1==t);if(-1==t)break;l+=String.fromCharCode((3&r)<<6|t)}return l}});